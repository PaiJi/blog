---
title: éƒ½2023å¹´äº†ï¼Œåˆ«å†ç”¨ Yarn v1 å•¦
date: 2023-06-11 12:49:36
tags:
categories: [FrontEnd]
permalink: dont-use-yarn-v1-anymore/
photos:
---
æœ€è¿‘åœ¨ Cloudflare Page ä¸Šè¿è¡Œ Next.js æ—¶ï¼Œlogå¾ˆæ— æƒ…çš„æŠ›äº†ä¸€å †é”™ï¼Œå…¶ä¸­ä¹‹ä¸€çš„åŸå› æ˜¯ï¼ŒCloudFlare Page é»˜è®¤ä»¥ Yarn3 å’Œ Node.js 18 ä½œä¸ºbuilder runtimeï¼Œè€Œcliå°–é”åœ°æŒ‡å‡ºï¼šæ£€æµ‹åˆ°yarn v1ã€‚è¿™ä¸‹æˆ‘åä¸ä½äº†ï¼Œä»€ä¹ˆï¼Œæˆ‘åœ¨ç”¨v1ï¼Œæˆ‘ä¸æ˜¯åœ¨ç”¨v2å—ğŸ˜§ï¼Ÿ
<!-- more -->
## ä½ ä»¥ä¸ºçš„
ä¸€ç•ªè°ƒæŸ¥åæˆ‘æ‰å‘ç°ï¼Œå¹¶ä¸æ˜¯ä½ ç”¨ä¸Šäº† Node.js 16.10 ä¹‹åï¼Œé€šè¿‡

```bash
corepack enable
```

å¯ç”¨ Yarn å°±ç®—åƒä¸Š Yarn V2äº†ã€‚è¿™ä¸ªé¡µé¢çš„é¡¶éƒ¨çš„æ¨ªå¹…è®©æˆ‘è¯¯ä»¥ä¸ºç”¨è¿™ä¸ªæ–¹å¼å®‰è£…å°±æ˜¯â€œç°ä»£åŒ–çš„ç‰ˆæœ¬â€ğŸ¤¦ï¼š
>This documentation covers modern versions of Yarn.  For 1.x docs, see classic.yarnpkg.com.


## æ–°ç‰ˆå¥½å¤„éƒ½æœ‰å•¥

çœ‹äº†ä¸€åœˆæ–‡æ¡£ï¼Œv2æœ€å¤§çš„å˜åŒ–å°±æ˜¯ [PnP](https://yarnpkg.com/features/pnp)ï¼Œæ¯•ç«Ÿ ä¼ ç»Ÿçš„ node_modules ç›®å½•å½¢å¼åœ¨å‘å±•è¿™ä¹ˆå¤šå¹´åå¯è°“æ˜¯é¥±å—è¯Ÿç—…ï¼Œæœ€å¤§çš„ç—›ç‚¹å°±æ˜¯ï¼šä½“ç§¯IOä¸¤å¼€èŠ±ï¼Œå¼€å‘è€…ç£ç›˜è‹¦ä¸å ªè¨€ã€‚ä¹Ÿæ­£å› å¦‚æ­¤æ‰å¯¼è‡´äº†pnpmçš„è¯ç”Ÿã€‚

è€Œç”¨ä¸Šäº† PnPåï¼Œè¿™ä¸ªé—®é¢˜èƒ½å¾—åˆ°æœ‰æ•ˆçš„ä¼˜åŒ–ï¼Œä»å®‰è£…é€Ÿåº¦åˆ°IOåˆ°å¯åŠ¨éƒ½æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚å…·ä½“çš„å†…å®¹éƒ½åœ¨è¿™é‡ŒğŸ‘‰ [PnP](https://yarnpkg.com/features/pnp)ã€‚

## å¼€å¹²ï¼
å¼€å§‹å‰è¯·å…ˆç¡®ä¿ä½ çš„ yarn v1 å·²ç»æ˜¯æœ€æ–°ç‰ˆï¼Œè¿™ä¹ˆå¤šå¹´äº†ä¸ä¼šæœ‰äººè¿ yarn v1 éƒ½ä¸æ˜¯æœ€æ–°å§ã€‚

å®˜æ–¹çš„è¿ç§»å¸®åŠ©é‡Œè¯´ä»v1å‡çº§åˆ°v2ï¼Œåªéœ€è¦è·‘è¿™è¡Œå‘½ä»¤è®¾ç½®ç‰ˆæœ¬å°±è¡Œï¼š
```bash
yarn set version berry
```

çœ‹åˆ°å¦‚ä¸‹ç»“æœå°±è¯´æ˜å·²ç»æˆåŠŸå®‰è£…v3ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ `yarn -v` çœ‹çœ‹ç‰ˆæœ¬å·ã€‚
```
â¤ YN0000: Retrieving https://repo.yarnpkg.com/3.6.0/packages/yarnpkg-cli/bin/yarn.js
â¤ YN0000: Saving the new release in .yarn/releases/yarn-3.6.0.cjs
â¤ YN0000: Done in 0s 549ms
```

æ­¤æ—¶ï¼Œä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸­åº”è¯¥å‡ºç°äº†ä¸€ä¸ª .yarnrc.yml æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†ä¸€è¡Œé»˜è®¤é…ç½®ï¼š
```
yarnPath: .yarn/releases/yarn-3.6.0.cjs
```

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼ŒPnPç»“æ„æ˜¯å¯é€‰çš„ï¼Œä½ å¯ä»¥é€šè¿‡è¿™æ ·å†™æ¥ç»§ç»­ä½¿ç”¨ä»¥å‰çš„ node-modulesï¼Œä»¥ä¾¿äºå¹³æ»‘è¿‡æ¸¡: 
```
nodeLinker: "node-modules"
```

ä½†æ˜¯æ—¢ç„¶è¿½æ±‚åˆºæ¿€ï¼Œæˆ‘å½“ç„¶æ˜¯ä¸€è·¯åˆ°åº•ï¼š
```
nodeLinker: "pnp"
```
(æˆ–è€…ç›´æ¥ä¸åŠ è¿™è¡Œï¼Œå› ä¸ºPnPæ˜¯ Yarn v2ä¹‹åçš„é»˜è®¤è¡Œä¸º)

ç„¶åè¿è¡Œ `yarn install`ï¼Œnode_modules ç›®å½•ä¼šè¢«åˆ é™¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…¨æ–°çš„ .yarn ç›®å½•ï¼Œ ä½ é©¬ä¸Šå°±ä¼šæ³¨æ„åˆ°ï¼Œæ–°çš„ .yarn ç›®å½•çš„ä½“ç§¯è¾ƒåŸå§‹ç›¸æ¯”ï¼Œå°äº†ä¸å°‘ã€‚

æœ€åï¼Œé¢å¯¹è¿™äº›æ–°å‡ºç°çš„æµ·é‡æ–‡ä»¶ï¼Œä½ éœ€è¦æ›´æ–°ä¸€ä¸‹ä½ çš„ `.gitignore`ï¼Œè¯·å‚è€ƒè¿™ç¯‡å®˜æ–¹æ–‡æ¡£ã€‚[which-files-should-be-gitignored](https://yarnpkg.com/getting-started/qa#which-files-should-be-gitignored)ã€‚

## æœ‰äº›ä¸å¤ªä¸€æ ·
### Yarn global å·²è¢«æ›¿æ¢ä¸º Yarn dlx
æ ¹æ®å®˜æ–¹æ–‡æ¡£[Renamed](https://yarnpkg.com/getting-started/migration#renamed)çš„æè¿°ï¼Œ`yarn global` å·²ç»è¢«æ›¿æ¢ä¸ºäº†`yarn dlx`ï¼Œç”¨æ¥æ‰§è¡Œé‚£äº›åªè¿è¡Œä¸€æ¬¡çš„ä»£ç ã€‚çœ‹èµ·æ¥è¿™å°±æ˜¯yarnç‰ˆçš„ `npx`ã€‚
### ä½¿ç”¨yarn runè€Œä¸æ˜¯  node_modules/.bin
è¿™ä¸ªç›®å½•éƒ½å·²ç»ç°é£çƒŸç­äº†ï¼Œè¯·æ”¹ç”¨ `yarn run`ã€‚
### ä½¿ç”¨ yarn node è€Œä¸æ˜¯ç›´æ¥ node æ¥è¿è¡Œä½ çš„è„šæœ¬
ç®€å•æ¥è¯´ä»¥å‰æˆ‘ä»¬ä¼šç›´æ¥è¿è¡ŒJSæ–‡ä»¶ï¼Œåƒè¿™æ ·ï¼š
```node
node main.js
```
ä½†æ˜¯æœ‰äº†PnPä¹‹åï¼ŒæŸ¥æ‰¾ä¾èµ–çš„æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œä½ å¾—å…ˆæŠŠä¾èµ–æè¿°æ–‡ä»¶æ³¨å…¥åˆ°è¿è¡Œæ—¶é‡Œã€‚å¦‚æœä½ ä½¿ç”¨ `yarn script`ï¼Œè¿™ä¸ªæ­¥éª¤æ˜¯è‡ªåŠ¨çš„ã€‚

å› æ­¤ï¼Œç°åœ¨è¯·æ”¹ç”¨ :
```node
yarn node main.js
```


## æ–°çš„å¾ˆå¥½ï¼Œä½†æ˜¯ä¸åŠ¨æ›´å¥½
æ ¹æ®[å®˜æ–¹æ–‡æ¡£](https://yarnpkg.com/features/pnp/#incompatible)ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨ react-native æˆ–è€… flowï¼Œé‚£ä¹ˆä½ è¿˜å¾—ç”¨ä¼ ç»Ÿçš„ `node_modules`ï¼Œä½ å¯ä»¥ç®€å•çš„èººå¹³â€”â€”æˆ–è€…ï¼Œå®‰è£…æ–°ç‰ˆçš„yarnä½†æ˜¯å°†:
```
nodeLinker: "node-modules"
```
åŸæ±åŸå‘³çš„ node-modulesï¼Œç°å·²é€šè¿‡ Yarn berry å…¨æ–°å‘ˆç°ã€‚

## æœ€å
å…¶å® Yarn V2 é¦–ä¸ªæ­£å¼ç‰ˆæœ¬æ˜¯åœ¨2020å¹´å‘å¸ƒçš„ï¼Œè·ç¦»å†™ä¸‹è¿™ç¯‡æ–‡ç« å·²ç»è¿‡å»äº†ä¸‰å¹´ï¼Œè€Œæœ€æ–°çš„ç‰ˆæœ¬å·²ç»åˆ°äº† Yarn 3.6ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰æ™®é€šå¼€å‘è€…å¯¹äºå‡çº§ Yarn ç‰ˆæœ¬è¿™ä»¶äº‹ç§¯ææ€§ä¸é«˜ï¼Œæ¯•ç«Ÿ 1.X ä»€ä¹ˆéƒ½èƒ½åšï¼Œâ€œåˆä¸æ˜¯ä¸èƒ½ç”¨â€ï¼Œæ„Ÿè§‰å°±ç®—æœ‰ä¸€å¤©yarn ä¸€è·¯é£™åˆ°äº† V100ï¼Œä¸–ç•Œä¸Šè¿˜æ˜¯æœ‰å¾ˆå¤šé¡¹ç›®åœ¨ç”¨1.XğŸ¤”ï¸ã€‚